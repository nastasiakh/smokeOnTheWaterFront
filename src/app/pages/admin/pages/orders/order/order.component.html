<div>
  <div class="mb-4">
    <h2>Order modification</h2>
  </div>
  <div *ngIf="order$ | async as order" >
    <div class="d-flex flex-column flex-lg-row justify-content-between">
      <div class="d-flex col-lg-4 flex-column">
        <app-input type="text" label="Name" [initialValue]="order.firstName"
                   (valueChanged)="onInputChange('firstName', $event)"/>
        <app-input type="text" label="Surname" [initialValue]="order.lastName"
                   (valueChanged)="onInputChange('lastName', $event)"/>
        <app-input type="phone" label="Phone" [initialValue]="order.phone"
                   (valueChanged)="onInputChange('phone', $event)"/>
        <app-input type="email" label="Email" [initialValue]="order.email"
                   (valueChanged)="onInputChange('email', $event)"/>
      </div>
      <div class="d-flex col-lg-6 flex-column">
        <app-input type="text" label="Country" [initialValue]="address.country"
                   (valueChanged)="onInputChange('country', $event)"/>
        <app-input type="text" label="Region" [initialValue]="address.region"
                   (valueChanged)="onInputChange('region', $event)"/>
        <app-input type="text" label="City or residential area" [initialValue]="address.location"
                   (valueChanged)="onInputChange('location', $event)"/>
        <app-input type="text" label="Street" [initialValue]="address.street"
                   (valueChanged)="onInputChange('street', $event)"/>
        <div class="d-flex w-100 justify-content-between">
          <app-input type="text" label="House number" [initialValue]="address.houseNum" class="col-3"
                     (valueChanged)="onInputChange('houseNum', $event)"/>
          <app-input type="number" label="Apartment" [initialValue]="address.apartment" class="col-2"
                     (valueChanged)="onInputChange('apartment', $event)"/>
          <app-input type="text" label="Zipcode" [initialValue]="address.zipcode" class="col-3"
                     (valueChanged)="onInputChange('zipcode', $event)"/>
        </div>
      </div>
    </div>

    <div class="">
      <h2>Products</h2>
      <mat-form-field>
        <mat-label>Products</mat-label>
        <mat-select [(ngModel)]="selectedProduct" (selectionChange)="onProductSelection($event.value)">
          <mat-option *ngFor="let product of (products$ | async)" [value]="product" [disabled]="isProductDisabled(product.id)">
            {{ product.title }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="d-flex col-5 flex-column">
      <h2>Cart</h2>
      <table>
        <thead>
        <tr>
          <th>Sku</th>
          <th>Title</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let product of selectedProducts">
          <td>{{ product.sku }}</td>
          <td>{{ product.title }}</td>
          <td>
            <input type="number" [(ngModel)]="product.quantity" (change)="updateQuantity(product)">
          </td>
          <td>{{ product.price }}</td>
          <td><button (click)="removeProductFromCart(product)">Remove</button></td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center">
      <app-button [text]="order.id ? 'Save changes' : 'Create user'" type="button" color="accent" (click)="saveOrder()" />
      <app-button *ngIf="order.id" text="Delete user" iconName="delete" iconColor="accent" color="primary"
                  (click)="removeOrder(order.id)"/>
    </div>
  </div>

</div>
